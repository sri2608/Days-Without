<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Days Without</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #F7F4EF;
    --ink: #1A1A18;
    --muted: #8A8780;
    --accent: #C4593A;
    --card: #FFFFFF;
    --border: #E2DDD7;
    --success: #4A7C59;
  }

  body.widget-mode {
    font-family: 'DM Sans', sans-serif;
    background: #F7F4EF;
    color: #1A1A18;
    padding: 10px;
    overflow: hidden;
  }
  body.widget-mode .app-view { display: none; }
  body.widget-mode .widget-view { display: block; }

  body.app-mode {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    padding: 2rem 1rem;
  }
  body.app-mode .widget-view { display: none; }
  body.app-mode .app-view { display: block; }

  .container { max-width: 560px; margin: 0 auto; }

  header { text-align: center; margin-bottom: 2rem; }
  header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2rem, 6vw, 3.5rem);
    letter-spacing: -0.02em;
    line-height: 1;
  }
  header p { color: var(--muted); font-size: 0.9rem; margin-top: 0.5rem; font-weight: 300; }

  .widget-url-box {
    background: white;
    border: 1.5px solid var(--border);
    border-radius: 12px;
    padding: 0.9rem 1rem;
    margin-bottom: 1.5rem;
  }
  .widget-url-box .label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .widget-url-box .url-row { display: flex; align-items: center; gap: 8px; }
  .widget-url-box .url-text {
    flex: 1;
    font-size: 0.72rem;
    color: var(--ink);
    word-break: break-all;
    line-height: 1.4;
    font-family: monospace;
    background: var(--bg);
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid var(--border);
  }
  .btn-copy {
    padding: 6px 12px;
    background: var(--ink);
    color: white;
    border: none;
    border-radius: 7px;
    font-family: inherit;
    font-size: 0.75rem;
    cursor: pointer;
    white-space: nowrap;
    transition: opacity 0.2s;
  }
  .btn-copy:hover { opacity: 0.8; }
  .btn-copy.copied { background: var(--success); }

  .add-form { display: flex; gap: 0.5rem; margin-bottom: 2rem; }
  .add-form input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    background: var(--card);
    font-family: inherit;
    font-size: 0.95rem;
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s;
  }
  .add-form input:focus { border-color: var(--ink); }
  .add-form input::placeholder { color: var(--muted); }
  .add-form button {
    padding: 0.75rem 1.25rem;
    background: var(--ink);
    color: white;
    border: none;
    border-radius: 10px;
    font-family: inherit;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: opacity 0.2s;
    white-space: nowrap;
  }
  .add-form button:hover { opacity: 0.8; }

  .cards { display: flex; flex-direction: column; gap: 1rem; }

  .card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 16px;
    padding: 1.25rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1.25rem;
    animation: slideIn 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;
    background: var(--success);
    border-radius: 16px 0 0 16px;
    transition: background 0.4s;
  }
  .card.reset-flash::before { background: var(--accent); }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .counter { text-align: center; min-width: 60px; }
  .counter .num { font-family: 'DM Serif Display', serif; font-size: 2.2rem; line-height: 1; }
  .counter .label { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin-top: 2px; }
  .divider { width: 1px; height: 40px; background: var(--border); }
  .info { flex: 1; }
  .info .name { font-size: 1rem; font-weight: 500; }
  .info .since { font-size: 0.8rem; color: var(--muted); margin-top: 2px; }
  .actions { display: flex; gap: 0.5rem; }
  .btn-reset, .btn-delete {
    padding: 0.4rem 0.7rem;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: none;
    font-family: inherit;
    font-size: 0.78rem;
    cursor: pointer;
    transition: all 0.15s;
  }
  .btn-reset { color: var(--accent); }
  .btn-reset:hover { background: var(--accent); color: white; border-color: var(--accent); }
  .btn-delete { color: var(--muted); }
  .btn-delete:hover { background: var(--ink); color: white; border-color: var(--ink); }
  .empty { text-align: center; color: var(--muted); padding: 3rem 1rem; font-size: 0.95rem; font-style: italic; }
  .empty span { display: block; font-size: 2rem; margin-bottom: 0.75rem; }

  /* Widget styles */
  .widget-view .w-title { font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: #8A8780; margin-bottom: 8px; font-weight: 500; }
  .widget-view .w-items { display: flex; flex-direction: column; gap: 6px; }
  .widget-view .w-item { display: flex; align-items: center; gap: 8px; background: white; border-radius: 8px; padding: 6px 10px; border-left: 3px solid #4A7C59; }
  .widget-view .w-num { font-family: 'DM Serif Display', serif; font-size: 1.4rem; line-height: 1; min-width: 32px; text-align: center; }
  .widget-view .w-info { flex: 1; overflow: hidden; }
  .widget-view .w-name { font-size: 0.72rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .widget-view .w-days { font-size: 0.6rem; color: #8A8780; }
  .widget-view .w-empty { font-size: 0.8rem; color: #8A8780; text-align: center; padding: 1rem 0; }
</style>
</head>
<body>

<div class="app-view">
  <div class="container">
    <header>
      <h1>Days Without</h1>
      <p>Track your streaks, one honest day at a time.</p>
    </header>

    <div class="widget-url-box" id="url-box" style="display:none">
      <div class="label">ðŸ“± Your Widget URL â€” paste this into Web Widget app</div>
      <div class="url-row">
        <div class="url-text" id="widget-url-text"></div>
        <button class="btn-copy" id="copy-btn" onclick="copyWidgetURL()">Copy</button>
      </div>
    </div>

    <div class="add-form">
      <input type="text" id="input" placeholder="e.g. smoking, junk food, procrastinatingâ€¦" maxlength="50">
      <button onclick="addTracker()">+ Add</button>
    </div>

    <div class="cards" id="cards"></div>
  </div>
</div>

<div class="widget-view">
  <div class="w-title">Days Without</div>
  <div class="w-items" id="w-items"></div>
</div>

<script>
  // Data is encoded into the URL hash so the widget URL always has latest data
  function encodeData(data) {
    return btoa(unescape(encodeURIComponent(JSON.stringify(data))));
  }

  function decodeData(str) {
    try { return JSON.parse(decodeURIComponent(escape(atob(str)))); }
    catch { return []; }
  }

  function load() {
    const match = window.location.hash.match(/[#&]data=([^&]*)/);
    return match ? decodeData(match[1]) : [];
  }

  function save(data) {
    const encoded = encodeData(data);
    const base = window.location.origin + window.location.pathname;
    window.history.replaceState(null, '', base + '#data=' + encoded);
    updateWidgetURL(data);
  }

  function getWidgetURL(data) {
    const encoded = encodeData(data);
    const base = window.location.origin + window.location.pathname;
    return base + '?view=widget#data=' + encoded;
  }

  function updateWidgetURL(data) {
    const box = document.getElementById('url-box');
    const urlText = document.getElementById('widget-url-text');
    if (!box || !urlText) return;
    if (data.length === 0) { box.style.display = 'none'; return; }
    box.style.display = 'block';
    urlText.textContent = getWidgetURL(data);
  }

  function copyWidgetURL() {
    const text = document.getElementById('widget-url-text').textContent;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copy-btn');
      btn.textContent = 'âœ“ Copied!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
    });
  }

  function daysSince(dateStr) {
    return Math.floor((Date.now() - new Date(dateStr).getTime()) / 86400000);
  }

  function formatDate(dateStr) {
    return new Date(dateStr).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
  }

  function renderApp() {
    const data = load();
    const container = document.getElementById('cards');
    if (!container) return;
    updateWidgetURL(data);

    if (data.length === 0) {
      container.innerHTML = `<div class="empty"><span>ðŸŒ¿</span>Nothing tracked yet.<br>Add something you want to go without.</div>`;
      return;
    }

    container.innerHTML = data.map((item, i) => {
      const days = daysSince(item.since);
      return `
        <div class="card" id="card-${i}">
          <div class="counter">
            <div class="num">${days}</div>
            <div class="label">${days === 1 ? 'day' : 'days'}</div>
          </div>
          <div class="divider"></div>
          <div class="info">
            <div class="name">Without ${item.name}</div>
            <div class="since">Since ${formatDate(item.since)}</div>
          </div>
          <div class="actions">
            <button class="btn-reset" onclick="reset(${i})">Reset</button>
            <button class="btn-delete" onclick="remove(${i})">âœ•</button>
          </div>
        </div>`;
    }).join('');
  }

  function renderWidget() {
    const data = load();
    const container = document.getElementById('w-items');
    if (!container) return;
    if (data.length === 0) {
      container.innerHTML = `<div class="w-empty">No trackers yet.</div>`;
      return;
    }
    container.innerHTML = data.slice(0, 4).map(item => {
      const days = daysSince(item.since);
      return `
        <div class="w-item">
          <div class="w-num">${days}</div>
          <div class="w-info">
            <div class="w-name">Without ${item.name}</div>
            <div class="w-days">${days === 1 ? 'day' : 'days'}</div>
          </div>
        </div>`;
    }).join('');
  }

  function addTracker() {
    const input = document.getElementById('input');
    const name = input.value.trim();
    if (!name) return;
    const data = load();
    data.unshift({ name, since: new Date().toISOString() });
    save(data);
    input.value = '';
    renderApp();
  }

  function reset(i) {
    const data = load();
    data[i].since = new Date().toISOString();
    save(data);
    renderApp();
    const card = document.getElementById(`card-${i}`);
    if (card) { card.classList.add('reset-flash'); setTimeout(() => card.classList.remove('reset-flash'), 800); }
  }

  function remove(i) {
    const data = load();
    data.splice(i, 1);
    save(data);
    renderApp();
  }

  document.getElementById('input')?.addEventListener('keydown', e => { if (e.key === 'Enter') addTracker(); });

  const isWidget = new URLSearchParams(window.location.search).get('view') === 'widget';
  document.body.classList.add(isWidget ? 'widget-mode' : 'app-mode');
  if (isWidget) renderWidget(); else renderApp();
</script>
</body>
</html>
